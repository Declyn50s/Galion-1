// Auto-generated NPA lookup (TypeScript)
// Utilitaire simple pour retrouver automatiquement la localité d’un NPA saisi
// + proposer des suggestions (par code ou par nom de localité).
// Encodage UTF-8, recherche insensible aux accents et à la casse.

export type NPAEntry = { code: number; locality: string };

export const NPA_DATA: NPAEntry[] = [
  { code: 1000, locality: "Lausanne" },
  { code: 1001, locality: "Lausanne" },
  { code: 1003, locality: "Lausanne" },
  { code: 1004, locality: "Lausanne" },
  { code: 1005, locality: "Lausanne" },
  { code: 1006, locality: "Lausanne" },
  { code: 1007, locality: "Lausanne" },
  { code: 1008, locality: "Prilly" },
  { code: 1009, locality: "Pully" },
  { code: 1010, locality: "Lausanne" },
  { code: 1011, locality: "Lausanne" },
  { code: 1012, locality: "Lausanne" },
  { code: 1014, locality: "Lausanne" },
  { code: 1015, locality: "Lausanne" },
  { code: 1018, locality: "Lausanne" },
  { code: 1020, locality: "Renens" },
  { code: 1022, locality: "Chavannes-près-Renens" },
  { code: 1023, locality: "Crissier" },
  { code: 1024, locality: "Ecublens" },
  { code: 1025, locality: "St-Sulpice" },
  { code: 1026, locality: "Echandens" },
  { code: 1027, locality: "Lonay" },
  { code: 1028, locality: "Préverenges" },
  { code: 1029, locality: "Villars-Ste-Croix" },
  { code: 1030, locality: "Bussigny" },
  { code: 1031, locality: "Mex" },
  { code: 1032, locality: "Romanel-sur-Lausanne" },
  { code: 1033, locality: "Cheseaux-sur-Lausanne" },
  { code: 1034, locality: "Boussens" },
  { code: 1035, locality: "Bournens" },
  { code: 1036, locality: "Sullens" },
  { code: 1037, locality: "Etagnières" },
  { code: 1038, locality: "Bercher" },
  { code: 1040, locality: "Echallens" },
  { code: 1043, locality: "Sugnens" },
  { code: 1044, locality: "Fey" },
  { code: 1045, locality: "Ogens" },
  { code: 1046, locality: "Rueyres" },
  { code: 1047, locality: "Oppens" },
  { code: 1052, locality: "Le Mont-sur-Lausanne" },
  { code: 1053, locality: "Cugy" },
  { code: 1054, locality: "Morrens" },
  { code: 1055, locality: "Froideville" },
  { code: 1058, locality: "Villars-Tiercelin" },
  { code: 1059, locality: "Peney-le-Jorat" },
  { code: 1060, locality: "St-Cierges" },
  { code: 1061, locality: "Villars-Mendraz" },
  { code: 1062, locality: "Sottens" },
  { code: 1066, locality: "Epalinges" },
  { code: 1068, locality: "Les Monts-de-Pully" },
  { code: 1070, locality: "Puidoux" },
  { code: 1071, locality: "Chexbres" },
  { code: 1072, locality: "Forel" },
  { code: 1073, locality: "Savigny, Mollie-Margot" },
  { code: 1076, locality: "Ferlens" },
  { code: 1077, locality: "Servion" },
  { code: 1078, locality: "Essertes" },
  { code: 1080, locality: "Les Cullayes" },
  { code: 1081, locality: "Montpreveyres" },
  { code: 1082, locality: "Corcelles-le-Jorat" },
  { code: 1083, locality: "Mézières" },
  { code: 1084, locality: "Carrouge" },
  { code: 1085, locality: "Vulliens" },
  { code: 1088, locality: "Ropraz" },
  { code: 1090, locality: "La Croix" },
  { code: 1091, locality: "Grandvaux" },
  { code: 1092, locality: "Belmont-sur-Lausanne" },
  { code: 1093, locality: "La Conversion" },
  { code: 1094, locality: "Paudex" },
  { code: 1095, locality: "Lutry" },
  { code: 1096, locality: "Cully" },
  { code: 1097, locality: "Riex" },
  { code: 1098, locality: "Epesses" },
  { code: 1110, locality: "Morges" },
  { code: 1217, locality: "Meyrin" },
  { code: 1350, locality: "Orbe" },
  { code: 1400, locality: "Yverdon-les-Bains" },
  { code: 1800, locality: "Vevey" },
  { code: 1807, locality: "Blonay" },
  { code: 2000, locality: "Neuchâtel" },
  { code: 1820, locality: "Montreux" },
  { code: 1680, locality: "Romont" },
  { code: 1860, locality: "Aigle" },
  { code: 1610, locality: "Oron-la-Ville" },
  { code: 1510, locality: "Moudon" },
  { code: 1197, locality: "Prangins" },
  { code: 1212, locality: "Grand-Lancy" },
  { code: 1112, locality: "Echichens" },
  { code: 2036, locality: "Cormondrèche" },
  { code: 1450, locality: "Sainte-Croix" },
  { code: 1523, locality: "Granges-Marnand" },
  { code: 1615, locality: "Bossonnens" },
  { code: 4057, locality: "Bâle" },
  { code: 74100, locality: "Annemasse" },
  { code: 1618, locality: "Châtel-St-Denis" },
  { code: 1315, locality: "La Sarraz" },
  { code: 1163, locality: "Etoy" },
  { code: 1114, locality: "Colombier" },
  { code: 1142, locality: "Pampigny" },
  { code: 1373, locality: "Chavornay" },
  { code: 1318, locality: "Pompaples" },
  { code: 1132, locality: "Lully" },
  { code: 1041, locality: "Poliez-Pittet" },
  { code: 1700, locality: "Fribourg" },
  { code: 1063, locality: "Chappelle-sur-Moudon" },
  { code: 1608, locality: "Chesalles-sur-Oron" },
  { code: 74500, locality: "Évian-les-Bains" },
  { code: 1348, locality: "Le Brassus" },
  { code: 1042, locality: "Bioley-Orjulaz" },
  { code: 1880, locality: "Bex" },
  { code: 1527, locality: "Villeneuve" },
  { code: 8408, locality: "Winterthur" },
  { code: 1162, locality: "Saint-Prex" },
  { code: 1804, locality: "Corsier-sur-Vevey" },
  { code: 1374, locality: "Corcelles-sur-Chavornay" },
];

// --- Utils ---

/** Supprime les accents/diacritiques et met en minuscule. */
export function normalize(text: string): string {
  return (
    text
      .normalize("NFD")
      // Supprime les diacritiques (compatible larges runtimes)
      .replace(/[\u0300-\u036f]/g, "")
      .toLowerCase()
      .trim()
  );
}

/** Recherche exacte par code (e.g. 1008 -> 'Prilly'). */
export function findByCode(code: number | string): NPAEntry | undefined {
  const n = typeof code === "string" ? parseInt(code, 10) : code;
  if (Number.isNaN(n)) return undefined;
  return NPA_DATA.find((e) => e.code === n);
}

/**
 * Suggestion universelle.
 * - Si `query` est numérique: match sur le début du NPA (préfixe).
 * - Sinon: recherche sur la localité, insensible aux accents/casse.
 * `limit` borne le nombre de résultats.
 */
export function suggest(query: string | number, limit = 10): NPAEntry[] {
  const q = String(query).trim();
  if (!q) return [];
  const isNumeric = /^\d+$/.test(q);
  if (isNumeric) {
    return NPA_DATA.filter((e) => String(e.code).startsWith(q)).slice(0, limit);
  }
  const nq = normalize(q);
  return NPA_DATA.filter((e) => normalize(e.locality).includes(nq)).slice(
    0,
    limit
  );
}

/** Renvoie juste la localité (ou undefined) pour un code donné. */
export function getLocality(code: number | string): string | undefined {
  return findByCode(code)?.locality;
}
